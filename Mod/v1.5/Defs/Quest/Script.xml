<?xml version="1.0" encoding="UTF-8"?>
<Defs>
  <QuestScriptDef>
    <defName>VV_EndGame_DreamumVictory_Reconstruction</defName>
    <autoAccept>true</autoAccept>
    <defaultChallengeRating>4</defaultChallengeRating>
    <isRootSpecial>true</isRootSpecial>
    <questNameRules>
      <rulesStrings>
        <li>questName->Reconstruction of peace</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->[asker_faction_name]'s [asker_faction_leaderTitle], [asker_nameDef], has sent a congratulatory message expressing admiration for your thriving hive. The [asker_faction_leaderTitle] wishes for your hive's continued prosperity and has shared a piece of information to alleviate your concerns about attacks from outlanders.
\nIt is said that before the Vivi scattered in the distant past, each hive had a Dreamum planted at its center, which was enlarged to protect the hive from enemies. However, all have been destroyed in modern times, and the specific techniques have been forgotten.
\nThe [asker_faction_leaderTitle] has disclosed the location of an ancient Vivi hive, believing that if enough mana is supplied to the remnants of the past, a giant Dreamum can be regrown. Establishing a new hive at this site and growing a giant Dreamum could potentially drive outlanders from the planet.
\nIf you proceed with this quest and begin the process of cultivating the Dreamum, the [asker_faction_leaderTitle] has promised material support and an alliance. However, once the Dreamum grows beyond a certain size, non-Vivi intelligences will gradually fall into unconsciousness, and outlanders who detect this anomaly will become hostile and continuously attack. Additionally, the enlargement of the Dreamum requires a substantial supply of mana.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_QuestUnique">
          <tag>EndGame_DreamumVictory</tag>
        </li>
        
        <li Class="QuestNode_GetSameQuestsCount">
          <storeAs>sameQuestsCount</storeAs>
        </li>
        
        <li Class="QuestNode_GetPawn">
          <storeAs>asker</storeAs>
          <mustBeFactionLeader>true</mustBeFactionLeader>
          <mustBeOfKind>VV_RoyalViviLeader</mustBeOfKind>
          <ifWorldPawnThenMustBeFreeOrLeader>true</ifWorldPawnThenMustBeFreeOrLeader>
          <mustBeWorldPawn>true</mustBeWorldPawn>
        </li>

        <!-- Add reward info -->
        <li Class="VVRace.QuestNode_AddPurgeOutlandersReward">
          <inSignalChoiceUsed>viviruins.LaunchedShip</inSignalChoiceUsed>
        </li>
        
        <li Class="VVRace.QuestNode_EndGame_DreamumVictory_FindRuinsTile">
          <storeAs>tile</storeAs>
        </li>
        <li Class="QuestNode_GenerateWorldObject">
          <def>VV_AncientViviRuins</def>
          <storeAs>viviruins</storeAs>
        </li>
        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$viviruins</worldObjects>
          <tile>$tile</tile>
        </li>

        <!-- Ending -->
        
        <!-- World object destroyed -->
        <li Class="QuestNode_NoWorldObject">
          <worldObject>$viviruins</worldObject>
          <node Class="QuestNode_End">
            <outcome>Fail</outcome>
          </node>
        </li>
        
        <li Class="QuestNode_Signal">
          <inSignal>viviruins.AltarDestroyed</inSignal>
          <node Class="QuestNode_End">
            <outcome>Fail</outcome>
          </node>
        </li>
        
        <!-- Launched ship -->
        <li Class="QuestNode_End">
          <inSignal>viviruins.LaunchedShip</inSignal>
          <outcome>Success</outcome>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>
</Defs>